import numpy as np

# knee_translation_y_spline_params = {'x_spline': np.array([-2.0944, -1.74533,
#     -1.39626, -1.0472, -0.698132, -0.349066, -0.174533, 0.197344, 0.337395,
#     0.490178, 1.52146, 2.0944]), 'y_spline': np.array([-0.0032, 0.00179,
#     0.00411, 0.0041, 0.00212, -0.001, -0.0031, -0.005227, -0.005435,
#     -0.005574, -0.005435, -0.00525]) * 100 # mm
# }

# knee_translation_z_spline_params = {'x_spline': np.array([-2.0944, -1.22173,
#     -0.523599, -0.349066, -0.174533, 0.159149, 2.0944]), 'y_spline':
#     np.array([-0.0186, -0.0042, 0.005, 0.0064, 0.0074, 0.0087, 0.008]) * 100 #
#     mm
# }


knee_rotation_y_spline_params = {
    'x_spline': np.array([0.00000000, 0.17453293, 0.34906585, 0.52359878,
                          0.69813170, 0.87266463, 1.04719755, 1.22173048,
                          1.39626340, 1.57079633, 1.74532925, 1.91986218, 
                          2.09439510]),
    'y_spline': np.array([0.00000000, 0.01268093, 0.02269692, 0.02960539,
                          0.03320492, 0.03353540, 0.03087791, 0.02575478,
                          0.01892953, 0.01140698, 0.00443314, -0.00050475, 
                          -0.00167820])}

knee_rotation_z_spline_params = {
    'x_spline': np.array([0.00000000, 0.17453293, 0.34906585, 0.52359878,
                          0.69813170, 0.87266463, 1.04719755, 1.22173048,
                          1.39626340, 1.57079633, 1.74532925, 1.91986218, 
                          2.09439510]),
    'y_spline': np.array([0.00000000, 0.05946103, 0.10939947, 0.15061811,
                          0.18391972, 0.21010710, 0.22998301, 0.24435025,
                          0.25401159, 0.25976981, 0.26242771, 0.26278805, 
                          0.26165362])}

knee_translation_y_spline_params = {
    'x_spline': np.array([0.00000000, 0.17453293, 0.34906585, 0.52359878,
                          0.69813170, 0.87266463, 1.04719755, 1.22173048,
                          1.39626340, 1.57079633, 1.74532925, 1.91986218, 
                          2.09439510]),
    'y_spline': np.array([0.00000000, 0.00098800, 0.00189900, 0.00273400,
                          0.00349200, 0.00417300, 0.00477700, 0.00530500,
                          0.00575600, 0.00613000, 0.00642700, 0.00664800, 
                          0.00679200]) * 100}

knee_translation_z_spline_params = {
    'x_spline': np.array([0.00000000, 0.17453293, 0.34906585, 0.52359878,
                          0.69813170, 0.87266463, 1.04719755, 1.22173048,
                          1.39626340, 1.57079633, 1.74532925, 1.91986218, 
                          2.09439510]),
    'y_spline': np.array([0.00000000, 0.00047900, 0.00083500, 0.00108600,
                          0.00125100, 0.00134600, 0.00139100, 0.00140300,
                          0.00140000, 0.00140000, 0.00142100, 0.00148100, 
                          0.00159900]) * 100}

FEBio_graft_patellar_tendon = {
    'type': 'trans iso Mooney-Rivlin',
    'density': 1.5e-09,
    'c1': 2.75,
    'c2': 0,
    'c3': 0.065,
    'c4': 115.89,
    'c5': 717.56,
    'lam_max': 1.042,
    'k': 103.31,  # or 1 / 2*0.00484
    'fiber': [1, 4]
    }

FEBio_graft_semitendinosus = {
    'type': 'trans iso Mooney-Rivlin',
    'density': 1.5e-09,
    'c1': 2.75,
    'c2': 0,
    'c3': 0.065,
    'c4': 115.89,
    'c5': 512.73,
    'lam_max': 1.042,
    'k': 103.31,  # or 1 / 2*0.00484
    'fiber': [1, 4]
    # 'fiber': [0, 0, 1],
    # 'active_contraction': {
    #     'ascl':1
    #     # 'ca0': 1,
    #     # 'camax':1,
        # }
    }

FEBio_graft_semitendinosus_prestrain = {
    'type': 'uncoupled prestrain elastic',
    'elastic': {'type':'trans iso Mooney-Rivlin',
                'density': 1.5e-09,
                'c1': 2.75,
                'c2': 0,
                'c3': 0.065,
                'c4': 115.89,
                'c5': 512.73,
                'lam_max': 1.042,
                'k': 103.31,  # or 1 / 2*0.00484
                'fiber': [1, 4]
                },
    'prestrain':{'type':'in-situ stretch',
                  'stretch': 1.035,
                  'isochoric': 1
                  }
   }

FEBio_graft_semitendinosus_stretch_prestrain = {
    'type': 'uncoupled prestrain elastic',
    'elastic': {'type':'trans iso Mooney-Rivlin',
                'density': 1.5e-09,
                'c1': 2.75,
                'c2': 0,
                'c3': 0.065,
                'c4': 115.89,
                'c5': 512.73,
                'lam_max': 1.042,
                'k': 103.31,  # or 1 / 2*0.00484
                'fiber': [1, 4]
                },
    'prestrain' :{'type':'in-situ stretch',
                  'stretch':1.035,
                  'isochoric':1
                  }
   }

FEBio_graft_semitendinosus_gradient_prestrain = {
    'type': 'uncoupled prestrain elastic',
    'elastic': {'type':'trans iso Mooney-Rivlin',
                'density': 1.5e-09,
                'c1': 2.75,
                'c2': 0,
                'c3': 0.065,
                'c4': 115.89,
                'c5': 512.73,
                'lam_max': 1.042,
                'k': 103.31,  # or 1 / 2*0.00484
                'fiber': [1, 4]
                },
    'prestrain': {'type': 'prestrain gradient',
                  'F0': {'type': 'map'}}
   }


# FEBio_graft_semitendinosus = {
#     'type': 'trans iso Mooney-Rivlin',
#     'density': 1.5e-09,
#     'c1': 2.75,
#     'c2': 0,
#     'c3': 0.065,
#     'c4': 115.89,
#     'c5': 512.73,
#     'lam_max': 1.042,
#     'k': 103.31,  # or 1 / 2*0.00484
#     'fiber': [1, 4],
#     'active_contraction': {
#         'ascl':0,
#         # 'ca0': 1,
#         # 'camax':1,
#         }}

FEBio_graft_gracilis = {
    'type': 'trans iso Mooney-Rivlin',
    'density': 1.5e-09,
    'c1': 2.75,
    'c2': 0,
    'c3': 0.065,
    'c4': 115.89,
    'c5': 791.4,
    'lam_max': 1.042,
    'k': 103.31,  # or 1 / 2*0.00484
    'fiber': [1, 4]
    }


FEBio_mooney_rivlin_ligaments = {
    'type': 'trans iso Mooney-Rivlin',
    'density': 1.5e-09,
    'c1': 1.95,
    'c2': 0,
    'c3': 0.0139,
    'c4': 116.22,
    'c5': 535.039,
    'lam_max': 1.046,
    'k': 73.2,  # or 2 / 0.00683
    'fiber': [1, 4]
}

FEBio_rigidbody_bone = {
    'type': 'rigid body',
    'density': 1.132e-06,
    'center_of_mass': [0, 0, 0]
}

FEBio_mooney_rivlin_cartilage = {
    'type': 'Mooney-Rivlin',
    'density': 1.5e-09,
    'c1': 0.856,
    'c2': 0,
    'k': 8
}

FEBio_mooney_rivlin_pat_cartilage = {
    'type': 'Mooney-Rivlin',
    'density': 1e-09,
    'c1': 2.54,
    'c2': 0,
    'k': 100
}

FEBio_fung_orthotropic_meniscus = {
    'type': 'Fung orthotropic',
    'density': 1.5e-09,
    'E1': 125,
    'E2': 27.5,
    'E3': 27.5,
    'G12': 2,
    'G23': 12.5,
    'G31': 2,
    'v12': 0.1,
    'v23': 0.33,
    'v31': 0.1,
    'c': 1,
    'k': 10
}

FEBio_mooney_rivlin_meniscus = {
    'type': 'trans iso Mooney-Rivlin',
    'density': 1e-09,
    'c1': 4.61,
    'c2': 0,
    'c3': 0.1197,
    'c4': 150,
    'c5': 400,
    'lam_max': 1.046,
    'k': 92.16,  # or 2 / 0.00683
    'fiber': [1, 4]}

FEBio_step = {
    'analysis': 'static',
    'time_steps': 20,
    'step_size': 0.05,
    'solver': {
        'max_refs': 25,
        # 'max_refs': 15,
        'max_ups': 0,
        'diverge_reform': 1,
        'reform_each_time_step': 1,
        'dtol': 0.01,
        'etol': 0.1,
        'rtol': 0,
        'lstol': 0.9,
        'min_residual': 0.001,
        'qnmethod': 'BROYDEN',
        'rhoi': -2,
        'symmetric_stiffness': 0,
    },
    'time_stepper': {
        'dtmin': 0.00000001,
        'dtmax': 0.05,
        'max_retries': 30,
        'opt_iter': 10,
        # 'aggressiveness': 0
    }
    # 'alpha': 1,
    # 'beta': 0.25,
    # 'gamma': 0.5
}

FEBio_sliding_elastic_contact = {
    'laugon': 1,
    'tolerance': 0,
    'gaptol': 0,
    'penalty': 0.1,
    'auto_penalty': 1,
    'two_pass': 1,
    'search_tol': 0.01,
    'symmetric_stiffness': 0,
    'search_radius': 0.005,
    'seg_up': 0,
    'tension': 0,
    'minaug': 0,
    'maxaug': 10,
    'fric_coeff': 0,
    'smooth_aug': 0,
    'node_reloc': 0
    # 'flip_master': 0,
    # 'flip_slave': 0
}

FEBio_sliding_facet_on_facet = {
    'laugon': 1,
    'tolerance': 0,
    'gaptol': 0,
    'penalty': 1,
    'auto_penalty': 1,
    # 'fric_coeff': 0,
    # 'fric_penalty': 0,
    'two_pass': 0,
    'search_tol': 0.01,
    # 'search_radius': 0.005,
    'minaug': 0,
    'maxaug': 10,
    'seg_up': 0}

FEBio_tied_elastic = {
    'laugon': 1,
    'tolerance': 0,
    'gaptol': 0,
    'penalty': 1e3,
    'auto_penalty': 0,
    'two_pass': 0,
    'knmult': 1,
    'search_tol': 0.01,
    'symmetric_stiffness': 0,
    'search_radius': 1,
    'minaug': 0,
    'maxaug': 10}

FEBio_tied_facet_on_facet = {
    'laugon': 1,
    'tolerance': 0,
    'penalty': 1e3,
    'minaug': 0,
    'maxaug': 10}

initial_prestrain = {
    'type':'prestrain',
    'init':1,
    'reset':1}

constraint_prestrain = {'type': 'prestrain',
                        'update': 1,
                        'tolerance': 0.01
                        # 'min_iters':5,
                        # 'max_iters':15
                        #'isochoric':1
                        }

surface_load_parameters = {
    'type': 'pressure',
    'linear': 1,
    'stiffness':1}

halonen_knee_angle = np.array([[0, 0],
                               [0.1, 0],
                               [0.2, 0],
                               [0.3, 0],
                               [0.4, 0],
                               [0.5, 0],
                               [0.6, 0],
                               [0.7, 0],
                               [0.8, 0],
                               [0.9, 0],
                               [1.0, 0],
                               [1.0592739814111183, 0.011041581764774655],
                               [1.1037294674694569, 0.019320855132402115],
                               [1.148184953527796, 0.027600128500029353],
                               [1.1852604197112293, 0.035881952475595],
                               [1.237125153445958, 0.0455411047378268],
                               [1.2964283626585607, 0.05796256539720601],
                               [1.340942304319869, 0.06900669776991886],
                               [1.385485473782662, 0.08143325964517456],
                               [1.452256386274625, 0.09799945820424405],
                               [1.5189688431636172, 0.11180079775822771],
                               [1.5709504881042848, 0.12698966803063094],
                               [1.6452183316770914, 0.14908303399193323],
                               [1.7268954229262876, 0.1725562788478402],
                               [1.7864616823522534, 0.1974196050301047],
                               [1.8533202782486704, 0.21813309209680254],
                               [1.9054480621967613, 0.24023410988191973],
                               [1.9650143216227272, 0.26509743606418434],
                               [2.046720640673408, 0.28995311042263416],
                               [2.1358069795989945, 0.31480623417314557],
                               [2.210104050973286, 0.3382820296369908],
                               [2.3138042906412584, 0.3562179046589117],
                               [2.424738411176711, 0.36723908156018015],
                               [2.51347401648448, 0.37550305128017775],
                               [2.6020927105863105, 0.3782373029900042],
                               [2.7274945928567256, 0.3754290836499679],
                               [2.8675980592739814, 0.36985090408896953],
                               [2.978035307184194, 0.35737077944701007],
                               [3.0811217630209855, 0.34627563491553176],
                               [3.1768281989828724, 0.3351830409919917],
                               [3.2798561992166952, 0.32132303745542773],
                               [3.3681533875021925, 0.30885056463728305],
                               [3.471093704331561, 0.2908432725930906],
                               [3.5667124568889923, 0.2756033901619222],
                               [3.6697112293213303, 0.2603609571228154],
                               [3.772739229555153, 0.24650095358625135],
                               [3.86109487344362, 0.2367933397731924],
                               [4.001022973051968, 0.22292058319693697],
                               [4.126220260711989, 0.21043535733910101],
                               [4.273557607996727, 0.19794247965745027],
                               [4.406018004325714, 0.1799249851815048],
                               [4.560589232477933, 0.16051740937920156],
                               [4.693195767814346, 0.14941206241597016],
                               [4.840591570702052, 0.13968404373940513],
                               [4.995367393464664, 0.12995347445490157],
                               [5.113330800257205, 0.1243829467177181],
                               [5.238703454726135, 0.12019229787513896],
                               [5.430437832466242, 0.11321383455602985],
                               [5.570599754486468, 0.11040051400011697],
                               [5.710849359911148, 0.11173448195183266],
                               [5.836368153387503, 0.11445598062196782],
                               [5.984143917694511, 0.12269954547845918],
                               [6.094961127024026, 0.12819100436955644],
                               [6.191105980008184, 0.13783485298415865],
                               [6.316829368094933, 0.15023335817209338],
                               [6.420412696556966, 0.162639515183843],
                               [6.494388262114924, 0.17090858611971715],
                               [6.598000818378443, 0.18469717263400953],
                               [6.694233354767054, 0.1984883097562402],
                               [6.768442742736893, 0.217816816712457],
                               [6.842710586309698, 0.2399101826737594],
                               [6.902101478926756, 0.2564789318407671],
                               [6.961550827146782, 0.27581254001286026],
                               [6.998918571345065, 0.2979186590138541],
                               [7.043695563219735, 0.32140465690945236],
                               [7.110641842520607, 0.34626543248377867],
                               [7.133278774770561, 0.36975908220319176],
                               [7.178084994446719, 0.3946275096013329],
                               [7.208014263167126, 0.41397132020517924],
                               [7.238031215291986, 0.43746241931665414],
                               [7.260638919740456, 0.45957363953352437],
                               [7.2760127433214485, 0.48859955787104703],
                               [7.306029695446309, 0.5120906569825219],
                               [7.336222014380079, 0.5438763331092537],
                               [7.373677441982814, 0.5701297406178758],
                               [7.396372829835741, 0.5963882493423746],
                               [7.4, 0.6115898726544691]])

halonen_knee_axial_force_25 = np.array([[0, 0],
                                        [0.1,    -6.721698113],
                                        [0.2,    -13.44339623],
                                        [0.3,    -20.16509434],
                                        [0.4,    -26.88679245],
                                        [0.5,    -33.60849057],
                                        [0.6,    -40.33018868],
                                        [0.7,    -47.05188679],
                                        [0.8,    -53.77358491],
                                        [0.9,    -60.49528302],
                                        [1.0,    -67.21698113],
                                        [1.0821526267798278, -83.13679245283015],
                                        [1.1488917724626502, -100.82547169811315],
                                        [1.2304306656379325, -125.58962264150938],
                                        [1.326892053026584, -145.0471698113207],
                                        [1.4456232026373006, -168.04245283018867],
                                        [1.564354352248018, -191.03773584905656],
                                        [1.6533807953987516, -210.4952830188679],
                                        [1.727519814827804, -231.72169811320754],
                                        [1.801606228519324, -258.25471698113205],
                                        [1.860822753735007, -284.78773584905656],
                                        [1.9571964648944378, -313.0896226415094],
                                        [2.008978045872203, -339.62264150943395],
                                        [2.068141965350354, -371.4622641509434],
                                        [2.119888475836431, -401.53301886792457],
                                        [2.171634986322508, -431.60377358490564],
                                        [2.223434102546118, -456.36792452830184],
                                        [2.2678333450234973, -477.59433962264154],
                                        [2.341989899698394, -497.0518867924528],
                                        [2.4012590306516106, -518.2783018867925],
                                        [2.4605281616048265, -539.5047169811321],
                                        [2.5124149540576557, -555.4245283018869],
                                        [2.623833906151365, -566.0377358490566],
                                        [2.7427404082205236, -571.3443396226415],
                                        [2.8542821070351403, -569.5754716981132],
                                        [2.9436066493652246, -558.9622641509435],
                                        [3.018078838465315, -546.5801886792453],
                                        [3.070316335835029, -527.122641509434],
                                        [3.1448586659184965, -507.66509433962267],
                                        [3.1970610927965204, -491.7452830188679],
                                        [3.234411166444554, -474.0566037735849],
                                        [3.279161113838816, -459.90566037735846],
                                        [3.294171284281405, -445.7547169811321],
                                        [3.331468752191906, -433.37264150943395],
                                        [3.3762888405695453, -412.14622641509436],
                                        [3.450883776390545, -387.3820754716981],
                                        [3.518061303219471, -360.8490566037736],
                                        [3.5852388300483975, -334.316037735849],
                                        [3.6820859928456198, -314.8584905660377],
                                        [3.778863014659466, -302.4764150943396],
                                        [3.860717542259943, -295.40094339622635],
                                        [3.979729255804166, -290.0943396226415],
                                        [4.083818475135022, -290.0943396226415],
                                        [4.180455214982114, -291.8632075471698],
                                        [4.2696394753454445, -295.40094339622635],
                                        [4.366223609455005, -302.4764150943396],
                                        [4.48511257627832, -309.5518867924528],
                                        [4.589079048888266, -321.9339622641509],
                                        [4.700427859998597, -339.62264150943395],
                                        [4.767202076173108, -353.77358490566036],
                                        [4.871115943045521, -371.4622641509434],
                                        [4.945325103457951, -385.61320754716985],
                                        [5.034386617100371, -401.53301886792457],
                                        [5.123553342217858, -406.83962264150944],
                                        [5.205214982114049, -419.2216981132076],
                                        [5.279424142526478, -433.37264150943395],
                                        [5.368415515185523, -456.36792452830184],
                                        [5.442607140352108, -472.2877358490566],
                                        [5.516833836010381, -484.6698113207548],
                                        [5.576190643192818, -497.0518867924528],
                                        [5.657887353580698, -505.89622641509436],
                                        [5.74703654345234, -512.9716981132076],
                                        [5.851038086553974, -521.8160377358491],
                                        [5.9475520796801575, -535.9669811320755],
                                        [5.999403801641299, -555.4245283018869],
                                        [6.06617801781581, -569.5754716981132],
                                        [6.118047275022796, -587.2641509433963],
                                        [6.177316405976012, -608.4905660377359],
                                        [6.23663814266676, -624.4103773584907],
                                        [6.333081994809569, -645.6367924528303],
                                        [6.407484042926282, -640.3301886792453],
                                        [6.489373641018449, -629.7169811320756],
                                        [6.556428421126465, -615.5660377358491],
                                        [6.601178368520729, -601.4150943396227],
                                        [6.645980921652522, -581.9575471698114],
                                        [6.675948656800169, -558.9622641509435],
                                        [6.72076874517781, -537.7358490566038],
                                        [6.765623904047135, -512.9716981132076],
                                        [6.795556568703094, -493.5141509433962],
                                        [6.84044679806411, -465.2122641509434],
                                        [6.877867012695519, -440.4481132075472],
                                        [6.915287227326927, -415.683962264151],
                                        [6.967577330434174, -390.9198113207547],
                                        [6.990057515606369, -373.2311320754717],
                                        [7.04236515395946, -346.6981132075472],
                                        [7.094690327558394, -318.3962264150943],
                                        [7.109770638984359, -297.16981132075466],
                                        [7.15460826260784, -274.1745283018868],
                                        [7.19202847723925, -249.41037735849056],
                                        [7.236866100862735, -226.4150943396226],
                                        [7.289191274461669, -198.1132075471698],
                                        [7.304306656379324, -173.34905660377353],
                                        [7.319369432559445, -153.89150943396223],
                                        [7.334484814477098, -129.127358490566],
                                        [7.371957634846042, -99.05660377358484],
                                        [7.394472890509925, -77.83018867924523],
                                        [7.4, -61.91037735849051]])
